<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Order Functionality</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 800px;
        margin: 0 auto;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .success {
        background-color: #d4edda;
        border-color: #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        border-color: #f5c6cb;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 15px;
        margin: 5px;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .result {
        margin-top: 10px;
        padding: 10px;
        background-color: #f8f9fa;
        border-radius: 4px;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>Order Functionality Test</h1>
    <p>This page tests the order management functionality with mock data.</p>

    <div class="test-section">
      <h3>1. Create Test Order</h3>
      <button onclick="createTestOrder()">Create Order</button>
      <div id="createResult" class="result"></div>
    </div>

    <div class="test-section">
      <h3>2. Get User Orders</h3>
      <button onclick="getUserOrders()">Get My Orders</button>
      <div id="getOrdersResult" class="result"></div>
    </div>

    <div class="test-section">
      <h3>3. Update Order Status (Admin)</h3>
      <button onclick="updateOrderStatus()">Update Status</button>
      <div id="updateResult" class="result"></div>
    </div>

    <div class="test-section">
      <h3>4. Delete Order (Admin)</h3>
      <button onclick="deleteOrder()">Delete Order</button>
      <div id="deleteResult" class="result"></div>
    </div>

    <div class="test-section">
      <h3>5. Clear All Mock Data</h3>
      <button onclick="clearMockData()" style="background-color: #dc3545">
        Clear All
      </button>
      <div id="clearResult" class="result"></div>
    </div>

    <script type="module">
      // Import the order functions
      import {
        createOrder,
        getUserOrders,
        updateOrderStatus,
        deleteOrder,
      } from "./src/utils/api/orders.js";

      let lastCreatedOrderId = null;

      window.createTestOrder = async function () {
        const resultDiv = document.getElementById("createResult");
        try {
          const testOrderData = {
            items: [
              {
                productId: "test_product_1",
                name: "Test Sneaker",
                price: 99.99,
                salePrice: 79.99,
                quantity: 2,
                selectedSize: "42",
                selectedColor: "Red",
                imageUrl: "/images/placeholder-product.jpg",
              },
            ],
            totalAmount: 159.98,
            shippingAddress: {
              street: "123 Test Street",
              city: "Test City",
              state: "Test State",
              zipCode: "12345",
              country: "Test Country",
            },
            paymentMethod: "credit_card",
            paymentStatus: "pending",
            orderStatus: "pending",
          };

          const order = await createOrder(testOrderData);
          lastCreatedOrderId = order._id;

          resultDiv.textContent =
            "Order created successfully!\n" + JSON.stringify(order, null, 2);
          resultDiv.parentElement.className = "test-section success";
        } catch (error) {
          resultDiv.textContent = "Error: " + error.message;
          resultDiv.parentElement.className = "test-section error";
        }
      };

      window.getUserOrders = async function () {
        const resultDiv = document.getElementById("getOrdersResult");
        try {
          const orders = await getUserOrders();
          resultDiv.textContent =
            "Found " +
            orders.length +
            " orders:\n" +
            JSON.stringify(orders, null, 2);
          resultDiv.parentElement.className = "test-section success";
        } catch (error) {
          resultDiv.textContent = "Error: " + error.message;
          resultDiv.parentElement.className = "test-section error";
        }
      };

      window.updateOrderStatus = async function () {
        const resultDiv = document.getElementById("updateResult");
        try {
          if (!lastCreatedOrderId) {
            throw new Error("No order created yet. Create an order first.");
          }

          const updatedOrder = await updateOrderStatus(
            lastCreatedOrderId,
            "confirmed"
          );
          resultDiv.textContent =
            "Order status updated successfully!\n" +
            JSON.stringify(updatedOrder, null, 2);
          resultDiv.parentElement.className = "test-section success";
        } catch (error) {
          resultDiv.textContent = "Error: " + error.message;
          resultDiv.parentElement.className = "test-section error";
        }
      };

      window.deleteOrder = async function () {
        const resultDiv = document.getElementById("deleteResult");
        try {
          if (!lastCreatedOrderId) {
            throw new Error("No order created yet. Create an order first.");
          }

          const result = await deleteOrder(lastCreatedOrderId);
          resultDiv.textContent =
            "Order deleted successfully!\n" + JSON.stringify(result, null, 2);
          resultDiv.parentElement.className = "test-section success";
          lastCreatedOrderId = null;
        } catch (error) {
          resultDiv.textContent = "Error: " + error.message;
          resultDiv.parentElement.className = "test-section error";
        }
      };

      window.clearMockData = function () {
        const resultDiv = document.getElementById("clearResult");
        try {
          localStorage.removeItem("mock_orders");
          localStorage.removeItem("mock_order_counter");
          lastCreatedOrderId = null;

          resultDiv.textContent = "All mock order data cleared successfully!";
          resultDiv.parentElement.className = "test-section success";
        } catch (error) {
          resultDiv.textContent = "Error: " + error.message;
          resultDiv.parentElement.className = "test-section error";
        }
      };
    </script>
  </body>
</html>
